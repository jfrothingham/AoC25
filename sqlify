# necessary import statements
import sqlite3
import pandas as pd


# specify input file
infile = "test_d1"
tname = "testtable_d1"
tname_out = "resultstable_d1"

# create dataframe from input file
infile_df = pd.read_table(f"{infile}", header=None)

# create column labels ['col0', 'col1', ..., 'coln'] for all columns
ncol = len(infile_df.keys())
colnames = []
for i in range(ncol):
    colnames.append(f"col{i}")

# apply column labels
print(infile_df.keys())
infile_df.columns = colnames
print(infile_df.keys())


# create an empty database
""" with sqlite3.open(f"{infile}.db", 'c') as db:
    print('new database!') """

# connect to database
connection = sqlite3.connect(f"{infile}.db")

# cursor
crsr = connection.cursor()

# create a table with first column of data
firstcol = "col0"
firstcolvalues = infile_df[firstcol].values
print(firstcolvalues[0])
crsr.execute(f"CREATE TABLE {tname} ({firstcol} varchar(255))")
crsr.execute(f"CREATE TABLE {tname_out} ({firstcol} varchar(255))")
for l in range(len(firstcolvalues)):
    crsr.execute(f"INSERT INTO {tname} ({firstcol}) VALUES ('{firstcolvalues[l]}')")

# add additional columns of data to table if necessary
if ncol > 1:
    for j in range(1,ncol):
        col = f"col{j}"
        crsr.execute(f"ALTER TABLE {tname} ADD {col} varchar(255)")
        val = infile_df[col].values
        nval = len(val)
        for k in range(nval):
            crsr.execute(f"INSERT INTO {tname} ({col}) VALUES ('{val[k]}')")


crsr.execute(f"INSERT INTO {tname_out}({firstcol}) SELECT {firstcol} from {tname}")

connection.commit()

# close the connection
connection.close()