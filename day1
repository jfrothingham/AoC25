import sqlite3
import pandas as pd
import time

""" 
dial begins pointing at 50
L### = minus ###
R### = plus ###
dial goes 0 to 99
0 = 100n where n is any integer

list of instructions in format L###, R###, etc., though ### may be any length

password is number of times dial is left pointing at 0 after any rotation in sequence

pseudocode plan

a = 50                          # initial starting point
L68                             # instruction: dial left 68 clicks
diff = -68                      # code to parse that L=subtraction and that 68 is amount to subtract by
b = a + diff = 50-68 = -18      # intermediate result is 18 clicks below 0
while b is not in range 0-99    # loop as many times as needed to keep b in allowable range
    if b < 0 then c = b + 100       # no negative numbers allowed - return to range 0-99
    if b > 99 then c = 100 - b      # no numbers in the 100s allowed - return to range 0-99
c = b                           # once result is in range, store it in variable c
write c to results column       # add c to database
a = c                           # set c (current position) as new starting point
                                # repeat for each instruction given until end of list
                                # count number of times c=0 occurs in results column - that's the password
 """

# connecting to the database
infile = "test_d1"
tname = "testtable_d1"
tname_out = "resultstable_d1"
connection = sqlite3.connect(f"{infile}.db")


# cursors - one for reading input, one for writing output
cr = connection.cursor()
cr2 = connection.cursor()

# get number of rows
cr.execute(f"SELECT COUNT(*) FROM {tname}")
nrows = cr.fetchall()[0]
#print(nrows)

# add columns for start point (a), parsed amount (diff), result/end point (c)
# note: sqlite only supports adding one column at a time :/
# note: only execute these lines once

cr2.execute(f"ALTER TABLE {tname_out} ADD StartPoint int(255)")
cr.execute(f"ALTER TABLE {tname} ADD Diff int(255)")
cr2.execute(f"ALTER TABLE {tname_out} ADD EndPoint int(255)")
cr.execute(f"ALTER TABLE {tname} ADD moduloHundred int(255)")

# update Diff column with parsed value
cr.execute(f"UPDATE {tname} SET Diff = replace (col0, 'L', '-') WHERE col0 LIKE 'L%'")
cr.execute(f"UPDATE {tname} SET Diff = replace (col0, 'R', '+') WHERE col0 LIKE 'R%'")

# set initial starting point - note: this updates all rows!

cr.execute(f"UPDATE {tname} SET moduloHundred = Diff % 100")

sp = 50
#cr.execute(f"UPDATE {tname} SET StartPoint = 50")
cr.execute(f"SELECT * from {tname}")

for row in cr:
        #print(row)
        mod100 = row[2]
        ident = row[0]
        ep = sp + mod100
        #print(ep)
        if ep > 99: ep = ep - 100
        if ep < 0: ep = ep + 100
        cr2.execute(f"UPDATE {tname_out} SET Endpoint = {ep} WHERE col0 = '{ident}' AND Startpoint IS NULL")
        cr2.execute(f"UPDATE {tname_out} SET Startpoint = {sp} WHERE col0 = '{ident}' AND Endpoint IS NOT NULL")
        #print(ep)
        #print(row)
        sp = ep
    
    
    
# print statement will execute if there are no errors
print("Connected to the database")

connection.commit()

# close the connection
connection.close()

